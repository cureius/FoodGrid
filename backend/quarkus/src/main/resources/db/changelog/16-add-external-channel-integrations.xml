<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.9.xsd">

  <changeSet id="16-add-external-columns-to-orders" author="antigravity">
    <preConditions onFail="MARK_RAN">
      <not>
        <columnExists tableName="orders" columnName="source_channel"/>
      </not>
    </preConditions>
    <addColumn tableName="orders">
      <column name="source_channel" type="VARCHAR(20)" defaultValue="FOODGRID">
        <constraints nullable="false"/>
      </column>
      <column name="external_order_id" type="VARCHAR(100)"/>
    </addColumn>
  </changeSet>

  <changeSet id="16-create-channel-integrations" author="antigravity">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="channel_integrations"/>
      </not>
    </preConditions>
    <createTable tableName="channel_integrations">
      <column name="id" type="VARCHAR(36)">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="outlet_id" type="VARCHAR(36)">
        <constraints nullable="false"/>
      </column>
      <column name="channel" type="VARCHAR(20)">
        <constraints nullable="false"/>
      </column>
      <column name="external_store_id" type="VARCHAR(100)"/>
      <column name="auth_payload" type="TEXT"/>
      <column name="is_active" type="BOOLEAN" defaultValueBoolean="true">
        <constraints nullable="false"/>
      </column>
      <column name="last_sync_at" type="TIMESTAMP"/>
      <column name="created_at" type="TIMESTAMP"/>
      <column name="updated_at" type="TIMESTAMP"/>
    </createTable>
  </changeSet>

  <changeSet id="16-create-menu-channel-mappings" author="antigravity">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="menu_channel_mappings"/>
      </not>
    </preConditions>
    <createTable tableName="menu_channel_mappings">
      <column name="id" type="VARCHAR(36)">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="outlet_id" type="VARCHAR(36)">
        <constraints nullable="false"/>
      </column>
      <column name="channel" type="VARCHAR(20)">
        <constraints nullable="false"/>
      </column>
      <column name="foodgrid_entity_id" type="VARCHAR(36)">
        <constraints nullable="false"/>
      </column>
      <column name="foodgrid_entity_type" type="VARCHAR(20)">
        <constraints nullable="false"/>
      </column>
      <column name="external_entity_id" type="VARCHAR(100)">
        <constraints nullable="false"/>
      </column>
      <column name="last_sync_at" type="TIMESTAMP"/>
    </createTable>
  </changeSet>
</databaseChangeLog>
